SET NOCOUNT ON;
GO


-- create [inrix] schema ---------------------------------------------------
-- note [inrix] schema permissions are defined at end of file
IF NOT EXISTS (
    SELECT TOP 1
        [schema_name]
    FROM
        [information_schema].[schemata]
    WHERE
        [schema_name] = 'inrix'
)
EXEC ('CREATE SCHEMA [inrix]')
GO


-- INRIX holiday date table --------------------------------------------------
CREATE TABLE [inrix].[holiday] (
	[date] date NOT NULL,
	[holiday] char(50) NOT NULL,
	[type] char(20) NOT NULL,
    INDEX [ccsi_inrix_holiday] CLUSTERED COLUMNSTORE,
    CONSTRAINT [ixuq_inrix_holiday] UNIQUE ([date], [holiday])
    )
INSERT INTO [inrix].[holiday] VALUES
    ('2000-01-14','Martin Luther King Jr. Day','Residual'),
    ('2000-01-17','Martin Luther King Jr. Day','Actual'),
    ('2000-01-18','Martin Luther King Jr. Day','Residual'),
    ('2000-02-10','Lincoln''s Birthday','Residual'),
    ('2000-02-11','Lincoln''s Birthday','Observed'),
    ('2000-02-12','Lincoln''s Birthday','Actual'),
    ('2000-02-14','Lincoln''s Birthday','Residual'),
    ('2000-02-18','Washington''s Birthday','Residual'),
    ('2000-02-21','Washington''s Birthday','Actual'),
    ('2000-02-22','Washington''s Birthday','Residual'),
    ('2000-03-30','Cesar Chavez Day','Residual'),
    ('2000-03-31','Cesar Chavez Day','Actual'),
    ('2000-04-03','Cesar Chavez Day','Residual'),
    ('2000-04-20','Good Friday','Residual'),
    ('2000-04-21','Good Friday','Actual'),
    ('2000-04-24','Good Friday','Residual'),
    ('2000-05-26','Memorial Day','Residual'),
    ('2000-05-29','Memorial Day','Actual'),
    ('2000-05-30','Memorial Day','Residual'),
    ('2000-07-03','Independence Day','Residual'),
    ('2000-07-04','Independence Day','Actual'),
    ('2000-07-05','Independence Day','Residual'),
    ('2000-09-01','Labor Day','Residual'),
    ('2000-09-04','Labor Day','Actual'),
    ('2000-09-05','Labor Day','Residual'),
    ('2000-10-07','Columbus Day','Residual'),
    ('2000-10-09','Columbus Day','Actual'),
    ('2000-10-10','Columbus Day','Residual'),
    ('2000-11-09','Veterans Day','Residual'),
    ('2000-11-10','Veterans Day','Observed'),
    ('2000-11-11','Veterans Day','Actual'),
    ('2000-11-13','Veterans Day','Residual'),
    ('2000-11-17','Thanksgiving','Residual'),
    ('2000-11-20','Thanksgiving','Residual'),
    ('2000-11-21','Thanksgiving','Residual'),
    ('2000-11-22','Thanksgiving','Residual'),
    ('2000-11-23','Thanksgiving','Actual'),
    ('2000-11-24','Day After Thanksgiving','Actual'),
    ('2000-11-27','Day After Thanksgiving','Residual'),
    ('2000-12-15','Christmas Eve','Residual'),
    ('2000-12-18','Christmas Eve','Residual'),
    ('2000-12-19','Christmas Eve','Residual'),
    ('2000-12-20','Christmas Eve','Residual'),
    ('2000-12-21','Christmas Eve','Residual'),
    ('2000-12-22','Christmas Eve','Residual'),
    ('2000-12-24','Christmas Eve','Actual'),
    ('2000-12-25','Christmas','Actual'),
    ('2000-12-26','Christmas','Residual'),
    ('2000-12-27','Christmas','Residual'),
    ('2000-12-28','Christmas','Residual'),
    ('2000-12-29','Christmas','Residual'),
    ('2001-01-01','New Years','Actual'),
    ('2001-01-02','New Years','Residual'),
    ('2001-01-12','Martin Luther King Jr. Day','Residual'),
    ('2001-01-15','Martin Luther King Jr. Day','Actual'),
    ('2001-01-16','Martin Luther King Jr. Day','Residual'),
    ('2001-02-09','Lincoln''s Birthday','Residual'),
    ('2001-02-12','Lincoln''s Birthday','Actual'),
    ('2001-02-13','Lincoln''s Birthday','Residual'),
    ('2001-02-16','Washington''s Birthday','Residual'),
    ('2001-02-19','Washington''s Birthday','Actual'),
    ('2001-02-20','Washington''s Birthday','Residual'),
    ('2001-03-29','Cesar Chavez Day','Residual'),
    ('2001-03-30','Cesar Chavez Day','Observed'),
    ('2001-03-31','Cesar Chavez Day','Actual'),
    ('2001-04-02','Cesar Chavez Day','Residual'),
    ('2001-04-12','Good Friday','Residual'),
    ('2001-04-13','Good Friday','Actual'),
    ('2001-04-16','Good Friday','Residual'),
    ('2001-05-25','Memorial Day','Residual'),
    ('2001-05-28','Memorial Day','Actual'),
    ('2001-05-29','Memorial Day','Residual'),
    ('2001-07-03','Independence Day','Residual'),
    ('2001-07-04','Independence Day','Actual'),
    ('2001-07-05','Independence Day','Residual'),
    ('2001-08-30','Labor Day','Residual'),
    ('2001-09-03','Labor Day','Actual'),
    ('2001-09-04','Labor Day','Residual'),
    ('2001-10-06','Columbus Day','Residual'),
    ('2001-10-08','Columbus Day','Actual'),
    ('2001-10-09','Columbus Day','Residual'),
    ('2001-11-09','Veterans Day','Residual'),
    ('2001-11-11','Veterans Day','Actual'),
    ('2001-11-12','Veterans Day','Observed'),
    ('2001-11-13','Veterans Day','Residual'),
    ('2001-11-16','Thanksgiving','Residual'),
    ('2001-11-19','Thanksgiving','Residual'),
    ('2001-11-20','Thanksgiving','Residual'),
    ('2001-11-21','Thanksgiving','Residual'),
    ('2001-11-22','Thanksgiving','Actual'),
    ('2001-11-23','Day After Thanksgiving','Actual'),
    ('2001-11-26','Day After Thanksgiving','Residual'),
    ('2001-12-14','Christmas Eve','Residual'),
    ('2001-12-17','Christmas Eve','Residual'),
    ('2001-12-18','Christmas Eve','Residual'),
    ('2001-12-19','Christmas Eve','Residual'),
    ('2001-12-20','Christmas Eve','Residual'),
    ('2001-12-21','Christmas Eve','Residual'),
    ('2001-12-24','Christmas Eve','Actual'),
    ('2001-12-25','Christmas','Actual'),
    ('2001-12-26','Christmas','Residual'),
    ('2001-12-27','Christmas','Residual'),
    ('2001-12-28','Christmas','Residual'),
    ('2001-12-31','New Years','Residual'),
    ('2002-01-01','New Years','Actual'),
    ('2002-01-02','New Years','Residual'),
    ('2002-01-18','Martin Luther King Jr. Day','Residual'),
    ('2002-01-21','Martin Luther King Jr. Day','Actual'),
    ('2002-01-22','Martin Luther King Jr. Day','Residual'),
    ('2002-02-11','Lincoln''s Birthday','Residual'),
    ('2002-02-12','Lincoln''s Birthday','Actual'),
    ('2002-02-13','Lincoln''s Birthday','Residual'),
    ('2002-02-15','Washington''s Birthday','Residual'),
    ('2002-02-18','Washington''s Birthday','Actual'),
    ('2002-02-19','Washington''s Birthday','Residual'),
    ('2002-03-28','Good Friday','Residual'),
    ('2002-03-29','Cesar Chavez Day','Residual'),
    ('2002-03-29','Good Friday','Actual'),
    ('2002-03-31','Cesar Chavez Day','Actual'),
    ('2002-04-01','Cesar Chavez Day','Observed'),
    ('2002-04-01','Good Friday','Residual'),
    ('2002-04-02','Cesar Chavez Day','Residual'),
    ('2002-05-24','Memorial Day','Residual'),
    ('2002-05-27','Memorial Day','Actual'),
    ('2002-05-28','Memorial Day','Residual'),
    ('2002-07-03','Independence Day','Residual'),
    ('2002-07-04','Independence Day','Actual'),
    ('2002-07-05','Independence Day','Residual'),
    ('2002-08-29','Labor Day','Residual'),
    ('2002-09-02','Labor Day','Actual'),
    ('2002-09-03','Labor Day','Residual'),
    ('2002-10-11','Columbus Day','Residual'),
    ('2002-10-14','Columbus Day','Actual'),
    ('2002-10-15','Columbus Day','Residual'),
    ('2002-11-08','Veterans Day','Residual'),
    ('2002-11-11','Veterans Day','Actual'),
    ('2002-11-12','Veterans Day','Residual'),
    ('2002-11-22','Thanksgiving','Residual'),
    ('2002-11-25','Thanksgiving','Residual'),
    ('2002-11-26','Thanksgiving','Residual'),
    ('2002-11-27','Thanksgiving','Residual'),
    ('2002-11-28','Thanksgiving','Actual'),
    ('2002-11-29','Day After Thanksgiving','Actual'),
    ('2002-12-02','Day After Thanksgiving','Residual'),
    ('2002-12-13','Christmas Eve','Residual'),
    ('2002-12-16','Christmas Eve','Residual'),
    ('2002-12-17','Christmas Eve','Residual'),
    ('2002-12-18','Christmas Eve','Residual'),
    ('2002-12-19','Christmas Eve','Residual'),
    ('2002-12-20','Christmas Eve','Residual'),
    ('2002-12-23','Christmas Eve','Residual'),
    ('2002-12-24','Christmas Eve','Actual'),
    ('2002-12-25','Christmas','Actual'),
    ('2002-12-26','Christmas','Residual'),
    ('2002-12-27','Christmas','Residual'),
    ('2002-12-30','New Years','Residual'),
    ('2002-12-31','New Years','Residual'),
    ('2003-01-01','New Years','Actual'),
    ('2003-01-02','New Years','Residual'),
    ('2003-01-17','Martin Luther King Jr. Day','Residual'),
    ('2003-01-20','Martin Luther King Jr. Day','Actual'),
    ('2003-01-21','Martin Luther King Jr. Day','Residual'),
    ('2003-02-11','Lincoln''s Birthday','Residual'),
    ('2003-02-12','Lincoln''s Birthday','Actual'),
    ('2003-02-13','Lincoln''s Birthday','Residual'),
    ('2003-02-14','Washington''s Birthday','Residual'),
    ('2003-02-17','Washington''s Birthday','Actual'),
    ('2003-02-18','Washington''s Birthday','Residual'),
    ('2003-03-28','Cesar Chavez Day','Residual'),
    ('2003-03-31','Cesar Chavez Day','Actual'),
    ('2003-04-01','Cesar Chavez Day','Residual'),
    ('2003-04-17','Good Friday','Residual'),
    ('2003-04-18','Good Friday','Actual'),
    ('2003-04-21','Good Friday','Residual'),
    ('2003-05-23','Memorial Day','Residual'),
    ('2003-05-26','Memorial Day','Actual'),
    ('2003-05-27','Memorial Day','Residual'),
    ('2003-07-03','Independence Day','Residual'),
    ('2003-07-04','Independence Day','Actual'),
    ('2003-07-07','Independence Day','Residual'),
    ('2003-08-28','Labor Day','Residual'),
    ('2003-09-01','Labor Day','Actual'),
    ('2003-09-02','Labor Day','Residual'),
    ('2003-10-10','Columbus Day','Residual'),
    ('2003-10-13','Columbus Day','Actual'),
    ('2003-10-14','Columbus Day','Residual'),
    ('2003-11-10','Veterans Day','Residual'),
    ('2003-11-11','Veterans Day','Actual'),
    ('2003-11-12','Veterans Day','Residual'),
    ('2003-11-21','Thanksgiving','Residual'),
    ('2003-11-24','Thanksgiving','Residual'),
    ('2003-11-25','Thanksgiving','Residual'),
    ('2003-11-26','Thanksgiving','Residual'),
    ('2003-11-27','Thanksgiving','Actual'),
    ('2003-11-28','Day After Thanksgiving','Actual'),
    ('2003-12-01','Day After Thanksgiving','Residual'),
    ('2003-12-12','Christmas Eve','Residual'),
    ('2003-12-15','Christmas Eve','Residual'),
    ('2003-12-16','Christmas Eve','Residual'),
    ('2003-12-17','Christmas Eve','Residual'),
    ('2003-12-18','Christmas Eve','Residual'),
    ('2003-12-19','Christmas Eve','Residual'),
    ('2003-12-22','Christmas Eve','Residual'),
    ('2003-12-23','Christmas Eve','Residual'),
    ('2003-12-24','Christmas Eve','Actual'),
    ('2003-12-25','Christmas','Actual'),
    ('2003-12-26','Christmas','Residual'),
    ('2003-12-29','Christmas','Residual'),
    ('2003-12-30','New Years','Residual'),
    ('2003-12-31','New Years','Residual'),
    ('2004-01-01','New Years','Actual'),
    ('2004-01-02','New Years','Residual'),
    ('2004-01-16','Martin Luther King Jr. Day','Residual'),
    ('2004-01-19','Martin Luther King Jr. Day','Actual'),
    ('2004-01-20','Martin Luther King Jr. Day','Residual'),
    ('2004-02-11','Lincoln''s Birthday','Residual'),
    ('2004-02-12','Lincoln''s Birthday','Actual'),
    ('2004-02-13','Lincoln''s Birthday','Residual'),
    ('2004-02-13','Washington''s Birthday','Residual'),
    ('2004-02-16','Washington''s Birthday','Actual'),
    ('2004-02-17','Washington''s Birthday','Residual'),
    ('2004-03-30','Cesar Chavez Day','Residual'),
    ('2004-03-31','Cesar Chavez Day','Actual'),
    ('2004-04-01','Cesar Chavez Day','Residual'),
    ('2004-04-08','Good Friday','Residual'),
    ('2004-04-09','Good Friday','Actual'),
    ('2004-04-12','Good Friday','Residual'),
    ('2004-05-28','Memorial Day','Residual'),
    ('2004-05-31','Memorial Day','Actual'),
    ('2004-06-01','Memorial Day','Residual'),
    ('2004-07-02','Independence Day','Residual'),
    ('2004-07-04','Independence Day','Actual'),
    ('2004-07-05','Independence Day','Observed'),
    ('2004-07-06','Independence Day','Residual'),
    ('2004-09-03','Labor Day','Residual'),
    ('2004-09-06','Labor Day','Actual'),
    ('2004-09-07','Labor Day','Residual'),
    ('2004-10-08','Columbus Day','Residual'),
    ('2004-10-11','Columbus Day','Actual'),
    ('2004-10-12','Columbus Day','Residual'),
    ('2004-11-10','Veterans Day','Residual'),
    ('2004-11-11','Veterans Day','Actual'),
    ('2004-11-12','Veterans Day','Residual'),
    ('2004-11-19','Thanksgiving','Residual'),
    ('2004-11-22','Thanksgiving','Residual'),
    ('2004-11-23','Thanksgiving','Residual'),
    ('2004-11-24','Thanksgiving','Residual'),
    ('2004-11-25','Thanksgiving','Actual'),
    ('2004-11-26','Day After Thanksgiving','Actual'),
    ('2004-11-29','Day After Thanksgiving','Residual'),
    ('2004-12-17','Christmas Eve','Residual'),
    ('2004-12-20','Christmas Eve','Residual'),
    ('2004-12-21','Christmas Eve','Residual'),
    ('2004-12-22','Christmas Eve','Residual'),
    ('2004-12-23','Christmas Eve','Residual'),
    ('2004-12-24','Christmas Eve','Actual'),
    ('2004-12-25','Christmas','Actual'),
    ('2004-12-27','Christmas','Residual'),
    ('2004-12-28','Christmas','Residual'),
    ('2004-12-29','Christmas','Residual'),
    ('2004-12-30','New Years','Residual'),
    ('2004-12-31','New Years','Observed'),
    ('2005-01-01','New Years','Actual'),
    ('2005-01-03','New Years','Residual'),
    ('2005-01-14','Martin Luther King Jr. Day','Residual'),
    ('2005-01-17','Martin Luther King Jr. Day','Actual'),
    ('2005-01-18','Martin Luther King Jr. Day','Residual'),
    ('2005-02-10','Lincoln''s Birthday','Residual'),
    ('2005-02-11','Lincoln''s Birthday','Observed'),
    ('2005-02-12','Lincoln''s Birthday','Actual'),
    ('2005-02-14','Lincoln''s Birthday','Residual'),
    ('2005-02-18','Washington''s Birthday','Residual'),
    ('2005-02-21','Washington''s Birthday','Actual'),
    ('2005-02-22','Washington''s Birthday','Residual'),
    ('2005-03-24','Good Friday','Residual'),
    ('2005-03-25','Good Friday','Actual'),
    ('2005-03-28','Good Friday','Residual'),
    ('2005-03-30','Cesar Chavez Day','Residual'),
    ('2005-03-31','Cesar Chavez Day','Actual'),
    ('2005-04-01','Cesar Chavez Day','Residual'),
    ('2005-05-27','Memorial Day','Residual'),
    ('2005-05-30','Memorial Day','Actual'),
    ('2005-05-31','Memorial Day','Residual'),
    ('2005-07-01','Independence Day','Residual'),
    ('2005-07-04','Independence Day','Actual'),
    ('2005-07-05','Independence Day','Residual'),
    ('2005-09-02','Labor Day','Residual'),
    ('2005-09-05','Labor Day','Actual'),
    ('2005-09-06','Labor Day','Residual'),
    ('2005-10-07','Columbus Day','Residual'),
    ('2005-10-10','Columbus Day','Actual'),
    ('2005-10-11','Columbus Day','Residual'),
    ('2005-11-10','Veterans Day','Residual'),
    ('2005-11-11','Veterans Day','Actual'),
    ('2005-11-14','Veterans Day','Residual'),
    ('2005-11-18','Thanksgiving','Residual'),
    ('2005-11-21','Thanksgiving','Residual'),
    ('2005-11-22','Thanksgiving','Residual'),
    ('2005-11-23','Thanksgiving','Residual'),
    ('2005-11-24','Thanksgiving','Actual'),
    ('2005-11-25','Day After Thanksgiving','Actual'),
    ('2005-11-28','Day After Thanksgiving','Residual'),
    ('2005-12-16','Christmas Eve','Residual'),
    ('2005-12-19','Christmas Eve','Residual'),
    ('2005-12-20','Christmas Eve','Residual'),
    ('2005-12-21','Christmas Eve','Residual'),
    ('2005-12-22','Christmas Eve','Residual'),
    ('2005-12-23','Christmas Eve','Residual'),
    ('2005-12-24','Christmas Eve','Actual'),
    ('2005-12-25','Christmas','Actual'),
    ('2005-12-26','Christmas','Residual'),
    ('2005-12-27','Christmas','Residual'),
    ('2005-12-28','Christmas','Residual'),
    ('2005-12-29','Christmas','Residual'),
    ('2005-12-30','New Years','Residual'),
    ('2006-01-01','New Years','Actual'),
    ('2006-01-02','New Years','Observed'),
    ('2006-01-03','New Years','Residual'),
    ('2006-01-13','Martin Luther King Jr. Day','Residual'),
    ('2006-01-16','Martin Luther King Jr. Day','Actual'),
    ('2006-01-17','Martin Luther King Jr. Day','Residual'),
    ('2006-02-10','Lincoln''s Birthday','Residual'),
    ('2006-02-12','Lincoln''s Birthday','Actual'),
    ('2006-02-13','Lincoln''s Birthday','Observed'),
    ('2006-02-14','Lincoln''s Birthday','Residual'),
    ('2006-02-17','Washington''s Birthday','Residual'),
    ('2006-02-20','Washington''s Birthday','Actual'),
    ('2006-02-21','Washington''s Birthday','Residual'),
    ('2006-03-30','Cesar Chavez Day','Residual'),
    ('2006-03-31','Cesar Chavez Day','Actual'),
    ('2006-04-03','Cesar Chavez Day','Residual'),
    ('2006-04-13','Good Friday','Residual'),
    ('2006-04-14','Good Friday','Actual'),
    ('2006-04-17','Good Friday','Residual'),
    ('2006-05-26','Memorial Day','Residual'),
    ('2006-05-29','Memorial Day','Actual'),
    ('2006-05-30','Memorial Day','Residual'),
    ('2006-07-03','Independence Day','Residual'),
    ('2006-07-04','Independence Day','Actual'),
    ('2006-07-05','Independence Day','Residual'),
    ('2006-09-01','Labor Day','Residual'),
    ('2006-09-04','Labor Day','Actual'),
    ('2006-09-05','Labor Day','Residual'),
    ('2006-10-06','Columbus Day','Residual'),
    ('2006-10-09','Columbus Day','Actual'),
    ('2006-10-10','Columbus Day','Residual'),
    ('2006-11-09','Veterans Day','Residual'),
    ('2006-11-10','Veterans Day','Observed'),
    ('2006-11-11','Veterans Day','Actual'),
    ('2006-11-13','Veterans Day','Residual'),
    ('2006-11-17','Thanksgiving','Residual'),
    ('2006-11-20','Thanksgiving','Residual'),
    ('2006-11-21','Thanksgiving','Residual'),
    ('2006-11-22','Thanksgiving','Residual'),
    ('2006-11-23','Thanksgiving','Actual'),
    ('2006-11-24','Day After Thanksgiving','Actual'),
    ('2006-11-27','Day After Thanksgiving','Residual'),
    ('2006-12-15','Christmas Eve','Residual'),
    ('2006-12-18','Christmas Eve','Residual'),
    ('2006-12-19','Christmas Eve','Residual'),
    ('2006-12-20','Christmas Eve','Residual'),
    ('2006-12-21','Christmas Eve','Residual'),
    ('2006-12-22','Christmas Eve','Residual'),
    ('2006-12-24','Christmas Eve','Actual'),
    ('2006-12-25','Christmas','Actual'),
    ('2006-12-26','Christmas','Residual'),
    ('2006-12-27','Christmas','Residual'),
    ('2006-12-28','Christmas','Residual'),
    ('2006-12-29','Christmas','Residual'),
    ('2007-01-01','New Years','Actual'),
    ('2007-01-02','New Years','Observed'),
    ('2007-01-12','Martin Luther King Jr. Day','Residual'),
    ('2007-01-15','Martin Luther King Jr. Day','Actual'),
    ('2007-01-16','Martin Luther King Jr. Day','Residual'),
    ('2007-02-09','Lincoln''s Birthday','Residual'),
    ('2007-02-12','Lincoln''s Birthday','Actual'),
    ('2007-02-13','Lincoln''s Birthday','Residual'),
    ('2007-02-16','Washington''s Birthday','Residual'),
    ('2007-02-19','Washington''s Birthday','Actual'),
    ('2007-02-20','Washington''s Birthday','Residual'),
    ('2007-03-29','Cesar Chavez Day','Residual'),
    ('2007-03-30','Cesar Chavez Day','Observed'),
    ('2007-03-31','Cesar Chavez Day','Actual'),
    ('2007-04-02','Cesar Chavez Day','Residual'),
    ('2007-04-05','Good Friday','Residual'),
    ('2007-04-06','Good Friday','Actual'),
    ('2007-04-09','Good Friday','Residual'),
    ('2007-05-25','Memorial Day','Residual'),
    ('2007-05-28','Memorial Day','Actual'),
    ('2007-05-29','Memorial Day','Residual'),
    ('2007-07-03','Independence Day','Residual'),
    ('2007-07-04','Independence Day','Actual'),
    ('2007-07-05','Independence Day','Residual'),
    ('2007-08-30','Labor Day','Residual'),
    ('2007-09-03','Labor Day','Actual'),
    ('2007-09-04','Labor Day','Residual'),
    ('2007-10-05','Columbus Day','Residual'),
    ('2007-10-08','Columbus Day','Actual'),
    ('2007-10-09','Columbus Day','Residual'),
    ('2007-11-09','Veterans Day','Residual'),
    ('2007-11-11','Veterans Day','Actual'),
    ('2007-11-12','Veterans Day','Observed'),
    ('2007-11-13','Veterans Day','Residual'),
    ('2007-11-16','Thanksgiving','Residual'),
    ('2007-11-19','Thanksgiving','Residual'),
    ('2007-11-20','Thanksgiving','Residual'),
    ('2007-11-21','Thanksgiving','Residual'),
    ('2007-11-22','Thanksgiving','Actual'),
    ('2007-11-23','Day After Thanksgiving','Actual'),
    ('2007-11-26','Day After Thanksgiving','Residual'),
    ('2007-12-14','Christmas Eve','Residual'),
    ('2007-12-17','Christmas Eve','Residual'),
    ('2007-12-18','Christmas Eve','Residual'),
    ('2007-12-19','Christmas Eve','Residual'),
    ('2007-12-20','Christmas Eve','Residual'),
    ('2007-12-21','Christmas Eve','Residual'),
    ('2007-12-24','Christmas Eve','Actual'),
    ('2007-12-25','Christmas','Actual'),
    ('2007-12-26','Christmas','Residual'),
    ('2007-12-27','Christmas','Residual'),
    ('2007-12-28','Christmas','Residual'),
    ('2007-12-31','New Years','Residual'),
    ('2008-01-01','New Years','Actual'),
    ('2008-01-02','New Years','Observed'),
    ('2008-01-18','Martin Luther King Jr. Day','Residual'),
    ('2008-01-21','Martin Luther King Jr. Day','Actual'),
    ('2008-01-22','Martin Luther King Jr. Day','Residual'),
    ('2008-02-11','Lincoln''s Birthday','Residual'),
    ('2008-02-12','Lincoln''s Birthday','Actual'),
    ('2008-02-13','Lincoln''s Birthday','Residual'),
    ('2008-02-15','Washington''s Birthday','Residual'),
    ('2008-02-18','Washington''s Birthday','Actual'),
    ('2008-02-19','Washington''s Birthday','Residual'),
    ('2008-03-20','Good Friday','Residual'),
    ('2008-03-21','Good Friday','Actual'),
    ('2008-03-24','Good Friday','Residual'),
    ('2008-03-28','Cesar Chavez Day','Residual'),
    ('2008-03-31','Cesar Chavez Day','Actual'),
    ('2008-04-01','Cesar Chavez Day','Residual'),
    ('2008-05-23','Memorial Day','Residual'),
    ('2008-05-26','Memorial Day','Actual'),
    ('2008-05-27','Memorial Day','Residual'),
    ('2008-07-03','Independence Day','Residual'),
    ('2008-07-04','Independence Day','Actual'),
    ('2008-07-07','Independence Day','Residual'),
    ('2008-08-28','Labor Day','Residual'),
    ('2008-09-01','Labor Day','Actual'),
    ('2008-09-02','Labor Day','Residual'),
    ('2008-10-10','Columbus Day','Residual'),
    ('2008-10-13','Columbus Day','Actual'),
    ('2008-10-14','Columbus Day','Residual'),
    ('2008-11-10','Veterans Day','Residual'),
    ('2008-11-11','Veterans Day','Actual'),
    ('2008-11-12','Veterans Day','Residual'),
    ('2008-11-21','Thanksgiving','Residual'),
    ('2008-11-24','Thanksgiving','Residual'),
    ('2008-11-25','Thanksgiving','Residual'),
    ('2008-11-26','Thanksgiving','Residual'),
    ('2008-11-27','Thanksgiving','Actual'),
    ('2008-11-28','Day After Thanksgiving','Actual'),
    ('2008-12-01','Day After Thanksgiving','Residual'),
    ('2008-12-19','Christmas Eve','Residual'),
    ('2008-12-22','Christmas Eve','Residual'),
    ('2008-12-23','Christmas Eve','Residual'),
    ('2008-12-24','Christmas Eve','Actual'),
    ('2008-12-25','Christmas','Actual'),
    ('2008-12-26','Christmas','Residual'),
    ('2008-12-29','Christmas','Residual'),
    ('2008-12-30','New Years','Residual'),
    ('2008-12-31','New Years','Residual'),
    ('2009-01-01','New Years','Actual'),
    ('2009-01-02','New Years','Observed'),
    ('2009-01-16','Martin Luther King Jr. Day','Residual'),
    ('2009-01-19','Martin Luther King Jr. Day','Actual'),
    ('2009-01-20','Martin Luther King Jr. Day','Residual'),
    ('2009-02-11','Lincoln''s Birthday','Residual'),
    ('2009-02-12','Lincoln''s Birthday','Actual'),
    ('2009-02-13','Lincoln''s Birthday','Residual'),
    ('2009-02-13','Washington''s Birthday','Residual'),
    ('2009-02-16','Washington''s Birthday','Actual'),
    ('2009-02-17','Washington''s Birthday','Residual'),
    ('2009-03-30','Cesar Chavez Day','Residual'),
    ('2009-03-31','Cesar Chavez Day','Actual'),
    ('2009-04-01','Cesar Chavez Day','Residual'),
    ('2009-04-09','Good Friday','Residual'),
    ('2009-04-10','Good Friday','Actual'),
    ('2009-04-13','Good Friday','Residual'),
    ('2009-05-22','Memorial Day','Residual'),
    ('2009-05-25','Memorial Day','Actual'),
    ('2009-05-26','Memorial Day','Residual'),
    ('2009-07-02','Independence Day','Residual'),
    ('2009-07-03','Independence Day','Observed'),
    ('2009-07-04','Independence Day','Actual'),
    ('2009-07-06','Independence Day','Residual'),
    ('2009-09-04','Labor Day','Residual'),
    ('2009-09-07','Labor Day','Actual'),
    ('2009-09-08','Labor Day','Residual'),
    ('2009-10-09','Columbus Day','Residual'),
    ('2009-10-12','Columbus Day','Actual'),
    ('2009-10-13','Columbus Day','Residual'),
    ('2009-11-10','Veterans Day','Residual'),
    ('2009-11-11','Veterans Day','Actual'),
    ('2009-11-12','Veterans Day','Residual'),
    ('2009-11-20','Thanksgiving','Residual'),
    ('2009-11-23','Thanksgiving','Residual'),
    ('2009-11-24','Thanksgiving','Residual'),
    ('2009-11-25','Thanksgiving','Residual'),
    ('2009-11-26','Thanksgiving','Actual'),
    ('2009-11-27','Day After Thanksgiving','Actual'),
    ('2009-11-30','Day After Thanksgiving','Residual'),
    ('2009-12-18','Christmas Eve','Residual'),
    ('2009-12-21','Christmas Eve','Residual'),
    ('2009-12-22','Christmas Eve','Residual'),
    ('2009-12-23','Christmas Eve','Residual'),
    ('2009-12-24','Christmas Eve','Actual'),
    ('2009-12-25','Christmas','Actual'),
    ('2009-12-28','Christmas','Residual'),
    ('2009-12-29','Christmas','Residual'),
    ('2009-12-30','New Years','Residual'),
    ('2009-12-31','New Years','Residual')
    INSERT INTO [inrix].[holiday] VALUES
    ('2010-01-01','New Years','Actual'),
    ('2010-01-04','New Years','Residual'),
    ('2010-01-15','Martin Luther King Jr. Day','Residual'),
    ('2010-01-18','Martin Luther King Jr. Day','Actual'),
    ('2010-01-19','Martin Luther King Jr. Day','Residual'),
    ('2010-02-12','Washington''s Birthday','Residual'),
    ('2010-02-15','Washington''s Birthday','Actual'),
    ('2010-02-16','Washington''s Birthday','Residual'),
    ('2010-03-30','Cesar Chavez Day','Residual'),
    ('2010-03-31','Cesar Chavez Day','Actual'),
    ('2010-04-01','Cesar Chavez Day','Residual'),
    ('2010-04-01','Good Friday','Residual'),
    ('2010-04-02','Good Friday','Actual'),
    ('2010-04-05','Good Friday','Residual'),
    ('2010-05-28','Memorial Day','Residual'),
    ('2010-05-31','Memorial Day','Actual'),
    ('2010-06-01','Memorial Day','Residual'),
    ('2010-07-02','Independence Day','Residual'),
    ('2010-07-04','Independence Day','Actual'),
    ('2010-07-05','Independence Day','Observed'),
    ('2010-07-06','Independence Day','Residual'),
    ('2010-09-03','Labor Day','Residual'),
    ('2010-09-06','Labor Day','Actual'),
    ('2010-09-07','Labor Day','Residual'),
    ('2010-10-08','Columbus Day','Residual'),
    ('2010-10-11','Columbus Day','Actual'),
    ('2010-10-12','Columbus Day','Residual'),
    ('2010-11-10','Veterans Day','Residual'),
    ('2010-11-11','Veterans Day','Actual'),
    ('2010-11-12','Veterans Day','Residual'),
    ('2010-11-19','Thanksgiving','Residual'),
    ('2010-11-22','Thanksgiving','Residual'),
    ('2010-11-23','Thanksgiving','Residual'),
    ('2010-11-24','Thanksgiving','Residual'),
    ('2010-11-25','Thanksgiving','Actual'),
    ('2010-11-26','Day After Thanksgiving','Actual'),
    ('2010-11-29','Day After Thanksgiving','Residual'),
    ('2010-12-17','Christmas Eve','Residual'),
    ('2010-12-20','Christmas Eve','Residual'),
    ('2010-12-21','Christmas Eve','Residual'),
    ('2010-12-22','Christmas Eve','Residual'),
    ('2010-12-23','Christmas Eve','Residual'),
    ('2010-12-24','Christmas Eve','Actual'),
    ('2010-12-25','Christmas','Actual'),
    ('2010-12-27','Christmas','Residual'),
    ('2010-12-28','Christmas','Residual'),
    ('2010-12-29','Christmas','Residual'),
    ('2010-12-30','New Years','Residual'),
    ('2010-12-31','New Years','Observed'),
    ('2011-01-01','New Years','Actual'),
    ('2011-01-03','New Years','Residual'),
    ('2011-01-14','Martin Luther King Jr. Day','Residual'),
    ('2011-01-17','Martin Luther King Jr. Day','Actual'),
    ('2011-01-18','Martin Luther King Jr. Day','Residual'),
    ('2011-02-18','Washington''s Birthday','Residual'),
    ('2011-02-21','Washington''s Birthday','Actual'),
    ('2011-02-22','Washington''s Birthday','Residual'),
    ('2011-03-30','Cesar Chavez Day','Residual'),
    ('2011-03-31','Cesar Chavez Day','Actual'),
    ('2011-04-01','Cesar Chavez Day','Residual'),
    ('2011-04-21','Good Friday','Residual'),
    ('2011-04-22','Good Friday','Actual'),
    ('2011-04-25','Good Friday','Residual'),
    ('2011-05-20','Memorial Day','Residual'),
    ('2011-05-23','Memorial Day','Actual'),
    ('2011-05-24','Memorial Day','Residual'),
    ('2011-07-01','Independence Day','Residual'),
    ('2011-07-04','Independence Day','Actual'),
    ('2011-07-05','Independence Day','Residual'),
    ('2011-09-02','Labor Day','Residual'),
    ('2011-09-05','Labor Day','Actual'),
    ('2011-09-06','Labor Day','Residual'),
    ('2011-10-07','Columbus Day','Residual'),
    ('2011-10-10','Columbus Day','Actual'),
    ('2011-10-11','Columbus Day','Residual'),
    ('2011-11-10','Veterans Day','Residual'),
    ('2011-11-11','Veterans Day','Actual'),
    ('2011-11-14','Veterans Day','Residual'),
    ('2011-11-18','Thanksgiving','Residual'),
    ('2011-11-21','Thanksgiving','Residual'),
    ('2011-11-22','Thanksgiving','Residual'),
    ('2011-11-23','Thanksgiving','Residual'),
    ('2011-11-24','Thanksgiving','Actual'),
    ('2011-11-25','Day After Thanksgiving','Actual'),
    ('2011-11-28','Day After Thanksgiving','Residual'),
    ('2011-12-16','Christmas Eve','Residual'),
    ('2011-12-19','Christmas Eve','Residual'),
    ('2011-12-20','Christmas Eve','Residual'),
    ('2011-12-21','Christmas Eve','Residual'),
    ('2011-12-22','Christmas Eve','Residual'),
    ('2011-12-23','Christmas Eve','Residual'),
    ('2011-12-24','Christmas Eve','Actual'),
    ('2011-12-25','Christmas','Actual'),
    ('2011-12-26','Christmas','Residual'),
    ('2011-12-27','Christmas','Residual'),
    ('2011-12-28','Christmas','Residual'),
    ('2011-12-29','Christmas','Residual'),
    ('2011-12-30','New Years','Residual'),
    ('2012-01-01','New Years','Actual'),
    ('2012-01-02','New Years','Observed'),
    ('2012-01-03','New Years','Residual'),
    ('2012-01-13','Martin Luther King Jr. Day','Residual'),
    ('2012-01-16','Martin Luther King Jr. Day','Actual'),
    ('2012-01-17','Martin Luther King Jr. Day','Residual'),
    ('2012-02-17','Washington''s Birthday','Residual'),
    ('2012-02-20','Washington''s Birthday','Actual'),
    ('2012-02-21','Washington''s Birthday','Residual'),
    ('2012-03-29','Cesar Chavez Day','Residual'),
    ('2012-03-30','Cesar Chavez Day','Observed'),
    ('2012-03-31','Cesar Chavez Day','Actual'),
    ('2012-04-02','Cesar Chavez Day','Residual'),
    ('2012-04-05','Good Friday','Residual'),
    ('2012-04-06','Good Friday','Actual'),
    ('2012-04-09','Good Friday','Residual'),
    ('2012-05-25','Memorial Day','Residual'),
    ('2012-05-28','Memorial Day','Actual'),
    ('2012-05-29','Memorial Day','Residual'),
    ('2012-07-03','Independence Day','Residual'),
    ('2012-07-04','Independence Day','Actual'),
    ('2012-07-05','Independence Day','Residual'),
    ('2012-08-30','Labor Day','Residual'),
    ('2012-09-03','Labor Day','Actual'),
    ('2012-09-04','Labor Day','Residual'),
    ('2012-10-05','Columbus Day','Residual'),
    ('2012-10-08','Columbus Day','Actual'),
    ('2012-10-09','Columbus Day','Residual'),
    ('2012-11-09','Veterans Day','Residual'),
    ('2012-11-11','Veterans Day','Actual'),
    ('2012-11-12','Veterans Day','Observed'),
    ('2012-11-13','Veterans Day','Residual'),
    ('2012-11-16','Thanksgiving','Residual'),
    ('2012-11-19','Thanksgiving','Residual'),
    ('2012-11-20','Thanksgiving','Residual'),
    ('2012-11-21','Thanksgiving','Residual'),
    ('2012-11-22','Thanksgiving','Actual'),
    ('2012-11-23','Day After Thanksgiving','Actual'),
    ('2012-11-26','Day After Thanksgiving','Residual'),
    ('2012-12-14','Christmas Eve','Residual'),
    ('2012-12-17','Christmas Eve','Residual'),
    ('2012-12-18','Christmas Eve','Residual'),
    ('2012-12-19','Christmas Eve','Residual'),
    ('2012-12-20','Christmas Eve','Residual'),
    ('2012-12-21','Christmas Eve','Residual'),
    ('2012-12-24','Christmas Eve','Actual'),
    ('2012-12-25','Christmas','Actual'),
    ('2012-12-26','Christmas','Residual'),
    ('2012-12-27','Christmas','Residual'),
    ('2012-12-28','Christmas','Residual'),
    ('2012-12-31','New Years','Residual'),
    ('2013-01-01','New Years','Actual'),
    ('2013-01-02','New Years','Residual'),
    ('2013-01-18','Martin Luther King Jr. Day','Residual'),
    ('2013-01-21','Martin Luther King Jr. Day','Actual'),
    ('2013-01-22','Martin Luther King Jr. Day','Residual'),
    ('2013-02-15','Washington''s Birthday','Residual'),
    ('2013-02-18','Washington''s Birthday','Actual'),
    ('2013-02-19','Washington''s Birthday','Residual'),
    ('2013-03-28','Good Friday','Residual'),
    ('2013-03-29','Cesar Chavez Day','Residual'),
    ('2013-03-29','Good Friday','Actual'),
    ('2013-03-31','Cesar Chavez Day','Actual'),
    ('2013-04-01','Cesar Chavez Day','Observed'),
    ('2013-04-01','Good Friday','Residual'),
    ('2013-04-02','Cesar Chavez Day','Residual'),
    ('2013-05-24','Memorial Day','Residual'),
    ('2013-05-27','Memorial Day','Actual'),
    ('2013-05-28','Memorial Day','Residual'),
    ('2013-07-03','Independence Day','Residual'),
    ('2013-07-04','Independence Day','Actual'),
    ('2013-07-05','Independence Day','Residual'),
    ('2013-08-29','Labor Day','Residual'),
    ('2013-09-02','Labor Day','Actual'),
    ('2013-09-03','Labor Day','Residual'),
    ('2013-10-11','Columbus Day','Residual'),
    ('2013-10-14','Columbus Day','Actual'),
    ('2013-10-15','Columbus Day','Residual'),
    ('2013-11-08','Veterans Day','Residual'),
    ('2013-11-11','Veterans Day','Actual'),
    ('2013-11-12','Veterans Day','Residual'),
    ('2013-11-22','Thanksgiving','Residual'),
    ('2013-11-25','Thanksgiving','Residual'),
    ('2013-11-26','Thanksgiving','Residual'),
    ('2013-11-27','Thanksgiving','Residual'),
    ('2013-11-28','Thanksgiving','Actual'),
    ('2013-11-29','Day After Thanksgiving','Actual'),
    ('2013-12-02','Day After Thanksgiving','Residual'),
    ('2013-12-13','Christmas Eve','Residual'),
    ('2013-12-16','Christmas Eve','Residual'),
    ('2013-12-17','Christmas Eve','Residual'),
    ('2013-12-18','Christmas Eve','Residual'),
    ('2013-12-19','Christmas Eve','Residual'),
    ('2013-12-20','Christmas Eve','Residual'),
    ('2013-12-23','Christmas Eve','Residual'),
    ('2013-12-24','Christmas Eve','Actual'),
    ('2013-12-25','Christmas','Actual'),
    ('2013-12-26','Christmas','Residual'),
    ('2013-12-27','Christmas','Residual'),
    ('2013-12-30','New Years','Residual'),
    ('2013-12-31','New Years','Residual'),
    ('2014-01-01','New Years','Actual'),
    ('2014-01-02','New Years','Residual'),
    ('2014-01-17','Martin Luther King Jr. Day','Residual'),
    ('2014-01-20','Martin Luther King Jr. Day','Actual'),
    ('2014-01-21','Martin Luther King Jr. Day','Residual'),
    ('2014-02-14','Washington''s Birthday','Residual'),
    ('2014-02-17','Washington''s Birthday','Actual'),
    ('2014-02-18','Washington''s Birthday','Residual'),
    ('2014-03-28','Cesar Chavez Day','Residual'),
    ('2014-03-31','Cesar Chavez Day','Actual'),
    ('2014-04-01','Cesar Chavez Day','Residual'),
    ('2014-04-17','Good Friday','Residual'),
    ('2014-04-18','Good Friday','Actual'),
    ('2014-04-21','Good Friday','Residual'),
    ('2014-05-23','Memorial Day','Residual'),
    ('2014-05-26','Memorial Day','Actual'),
    ('2014-05-27','Memorial Day','Residual'),
    ('2014-07-03','Independence Day','Residual'),
    ('2014-07-04','Independence Day','Actual'),
    ('2014-07-07','Independence Day','Residual'),
    ('2014-08-28','Labor Day','Residual'),
    ('2014-09-01','Labor Day','Actual'),
    ('2014-09-02','Labor Day','Residual'),
    ('2014-10-10','Columbus Day','Residual'),
    ('2014-10-13','Columbus Day','Actual'),
    ('2014-10-14','Columbus Day','Residual'),
    ('2014-11-10','Veterans Day','Residual'),
    ('2014-11-11','Veterans Day','Actual'),
    ('2014-11-12','Veterans Day','Residual'),
    ('2014-11-21','Thanksgiving','Residual'),
    ('2014-11-24','Thanksgiving','Residual'),
    ('2014-11-25','Thanksgiving','Residual'),
    ('2014-11-26','Thanksgiving','Residual'),
    ('2014-11-27','Thanksgiving','Actual'),
    ('2014-11-28','Day After Thanksgiving','Actual'),
    ('2014-12-01','Day After Thanksgiving','Residual'),
    ('2014-12-19','Christmas Eve','Residual'),
    ('2014-12-22','Christmas Eve','Residual'),
    ('2014-12-23','Christmas Eve','Residual'),
    ('2014-12-24','Christmas Eve','Actual'),
    ('2014-12-25','Christmas','Actual'),
    ('2014-12-26','Christmas','Residual'),
    ('2014-12-29','Christmas','Residual'),
    ('2014-12-30','New Years','Residual'),
    ('2014-12-31','New Years','Residual'),
    ('2015-01-01','New Years','Actual'),
    ('2015-01-02','New Years','Residual'),
    ('2015-01-16','Martin Luther King Jr. Day','Residual'),
    ('2015-01-19','Martin Luther King Jr. Day','Actual'),
    ('2015-01-20','Martin Luther King Jr. Day','Residual'),
    ('2015-02-13','Washington''s Birthday','Residual'),
    ('2015-02-16','Washington''s Birthday','Actual'),
    ('2015-02-17','Washington''s Birthday','Residual'),
    ('2015-03-30','Cesar Chavez Day','Residual'),
    ('2015-03-31','Cesar Chavez Day','Actual'),
    ('2015-04-01','Cesar Chavez Day','Residual'),
    ('2015-04-02','Good Friday','Residual'),
    ('2015-04-03','Good Friday','Actual'),
    ('2015-04-06','Good Friday','Residual'),
    ('2015-05-22','Memorial Day','Residual'),
    ('2015-05-25','Memorial Day','Actual'),
    ('2015-05-26','Memorial Day','Residual'),
    ('2015-07-02','Independence Day','Residual'),
    ('2015-07-03','Independence Day','Observed'),
    ('2015-07-04','Independence Day','Actual'),
    ('2015-07-06','Independence Day','Residual'),
    ('2015-09-04','Labor Day','Residual'),
    ('2015-09-07','Labor Day','Actual'),
    ('2015-09-08','Labor Day','Residual'),
    ('2015-10-09','Columbus Day','Residual'),
    ('2015-10-12','Columbus Day','Actual'),
    ('2015-10-13','Columbus Day','Residual'),
    ('2015-11-10','Veterans Day','Residual'),
    ('2015-11-11','Veterans Day','Actual'),
    ('2015-11-12','Veterans Day','Residual'),
    ('2015-11-20','Thanksgiving','Residual'),
    ('2015-11-23','Thanksgiving','Residual'),
    ('2015-11-24','Thanksgiving','Residual'),
    ('2015-11-25','Thanksgiving','Residual'),
    ('2015-11-26','Thanksgiving','Actual'),
    ('2015-11-27','Day After Thanksgiving','Actual'),
    ('2015-11-30','Day After Thanksgiving','Residual'),
    ('2015-12-18','Christmas Eve','Residual'),
    ('2015-12-21','Christmas Eve','Residual'),
    ('2015-12-22','Christmas Eve','Residual'),
    ('2015-12-23','Christmas Eve','Residual'),
    ('2015-12-24','Christmas Eve','Actual'),
    ('2015-12-25','Christmas','Actual'),
    ('2015-12-28','Christmas','Residual'),
    ('2015-12-29','Christmas','Residual'),
    ('2015-12-30','New Years','Residual'),
    ('2015-12-31','New Years','Residual'),
    ('2016-01-01','New Years','Actual'),
    ('2016-01-04','New Years','Residual'),
    ('2016-01-15','Martin Luther King Jr. Day','Residual'),
    ('2016-01-18','Martin Luther King Jr. Day','Actual'),
    ('2016-01-19','Martin Luther King Jr. Day','Residual'),
    ('2016-02-12','Washington''s Birthday','Residual'),
    ('2016-02-15','Washington''s Birthday','Actual'),
    ('2016-02-16','Washington''s Birthday','Residual'),
    ('2016-03-24','Good Friday','Residual'),
    ('2016-03-25','Good Friday','Actual'),
    ('2016-03-28','Good Friday','Residual'),
    ('2016-03-30','Cesar Chavez Day','Residual'),
    ('2016-03-31','Cesar Chavez Day','Actual'),
    ('2016-04-01','Cesar Chavez Day','Residual'),
    ('2016-05-27','Memorial Day','Residual'),
    ('2016-05-30','Memorial Day','Actual'),
    ('2016-05-31','Memorial Day','Residual'),
    ('2016-07-01','Independence Day','Residual'),
    ('2016-07-04','Independence Day','Actual'),
    ('2016-07-05','Independence Day','Residual'),
    ('2016-09-02','Labor Day','Residual'),
    ('2016-09-05','Labor Day','Actual'),
    ('2016-09-06','Labor Day','Residual'),
    ('2016-10-07','Columbus Day','Residual'),
    ('2016-10-10','Columbus Day','Actual'),
    ('2016-10-11','Columbus Day','Residual'),
    ('2016-11-10','Veterans Day','Residual'),
    ('2016-11-11','Veterans Day','Actual'),
    ('2016-11-14','Veterans Day','Residual'),
    ('2016-11-18','Thanksgiving','Residual'),
    ('2016-11-21','Thanksgiving','Residual'),
    ('2016-11-22','Thanksgiving','Residual'),
    ('2016-11-23','Thanksgiving','Residual'),
    ('2016-11-24','Thanksgiving','Actual'),
    ('2016-11-25','Day After Thanksgiving','Actual'),
    ('2016-11-28','Day After Thanksgiving','Residual'),
    ('2016-12-16','Christmas Eve','Residual'),
    ('2016-12-19','Christmas Eve','Residual'),
    ('2016-12-20','Christmas Eve','Residual'),
    ('2016-12-21','Christmas Eve','Residual'),
    ('2016-12-22','Christmas Eve','Residual'),
    ('2016-12-23','Christmas Eve','Residual'),
    ('2016-12-24','Christmas Eve','Actual'),
    ('2016-12-25','Christmas','Actual'),
    ('2016-12-26','Christmas','Residual'),
    ('2016-12-27','Christmas','Residual'),
    ('2016-12-28','Christmas','Residual'),
    ('2016-12-29','Christmas','Residual'),
    ('2016-12-30','New Years','Residual'),
    ('2017-01-01','New Years','Actual'),
    ('2017-01-02','New Years','Observed'),
    ('2017-01-03','New Years','Residual'),
    ('2017-01-13','Martin Luther King Jr. Day','Residual'),
    ('2017-01-16','Martin Luther King Jr. Day','Actual'),
    ('2017-01-17','Martin Luther King Jr. Day','Residual'),
    ('2017-02-17','Washington''s Birthday','Residual'),
    ('2017-02-20','Washington''s Birthday','Actual'),
    ('2017-02-21','Washington''s Birthday','Residual'),
    ('2017-03-30','Cesar Chavez Day','Residual'),
    ('2017-03-31','Cesar Chavez Day','Actual'),
    ('2017-04-03','Cesar Chavez Day','Residual'),
    ('2017-04-13','Good Friday','Residual'),
    ('2017-04-14','Good Friday','Actual'),
    ('2017-04-17','Good Friday','Residual'),
    ('2017-05-26','Memorial Day','Residual'),
    ('2017-05-29','Memorial Day','Actual'),
    ('2017-05-30','Memorial Day','Residual'),
    ('2017-07-03','Independence Day','Residual'),
    ('2017-07-04','Independence Day','Actual'),
    ('2017-07-05','Independence Day','Residual'),
    ('2017-09-01','Labor Day','Residual'),
    ('2017-09-04','Labor Day','Actual'),
    ('2017-09-05','Labor Day','Residual'),
    ('2017-10-06','Columbus Day','Residual'),
    ('2017-10-09','Columbus Day','Actual'),
    ('2017-10-10','Columbus Day','Residual'),
    ('2017-11-09','Veterans Day','Residual'),
    ('2017-11-10','Veterans Day','Observed'),
    ('2017-11-11','Veterans Day','Actual'),
    ('2017-11-13','Veterans Day','Residual'),
    ('2017-11-17','Thanksgiving','Residual'),
    ('2017-11-20','Thanksgiving','Residual'),
    ('2017-11-21','Thanksgiving','Residual'),
    ('2017-11-22','Thanksgiving','Residual'),
    ('2017-11-23','Thanksgiving','Actual'),
    ('2017-11-24','Day After Thanksgiving','Actual'),
    ('2017-11-27','Day After Thanksgiving','Residual'),
    ('2017-12-15','Christmas Eve','Residual'),
    ('2017-12-18','Christmas Eve','Residual'),
    ('2017-12-19','Christmas Eve','Residual'),
    ('2017-12-20','Christmas Eve','Residual'),
    ('2017-12-21','Christmas Eve','Residual'),
    ('2017-12-22','Christmas Eve','Residual'),
    ('2017-12-24','Christmas Eve','Actual'),
    ('2017-12-25','Christmas','Actual'),
    ('2017-12-26','Christmas','Residual'),
    ('2017-12-27','Christmas','Residual'),
    ('2017-12-28','Christmas','Residual'),
    ('2017-12-29','Christmas','Residual'),
    ('2018-01-01','New Years','Actual'),
    ('2018-01-02','New Years','Residual'),
    ('2018-01-12','Martin Luther King Jr. Day','Residual'),
    ('2018-01-15','Martin Luther King Jr. Day','Actual'),
    ('2018-01-16','Martin Luther King Jr. Day','Residual'),
    ('2018-02-16','Washington''s Birthday','Residual'),
    ('2018-02-19','Washington''s Birthday','Actual'),
    ('2018-02-20','Washington''s Birthday','Residual'),
    ('2018-03-29','Cesar Chavez Day','Residual'),
    ('2018-03-29','Good Friday','Residual'),
    ('2018-03-30','Cesar Chavez Day','Observed'),
    ('2018-03-30','Good Friday','Actual'),
    ('2018-03-31','Cesar Chavez Day','Actual'),
    ('2018-04-02','Cesar Chavez Day','Residual'),
    ('2018-04-02','Good Friday','Residual'),
    ('2018-05-25','Memorial Day','Residual'),
    ('2018-05-28','Memorial Day','Actual'),
    ('2018-05-29','Memorial Day','Residual'),
    ('2018-07-03','Independence Day','Residual'),
    ('2018-07-04','Independence Day','Actual'),
    ('2018-07-05','Independence Day','Residual'),
    ('2018-08-30','Labor Day','Residual'),
    ('2018-09-03','Labor Day','Actual'),
    ('2018-09-04','Labor Day','Residual'),
    ('2018-10-05','Columbus Day','Residual'),
    ('2018-10-08','Columbus Day','Actual'),
    ('2018-10-09','Columbus Day','Residual'),
    ('2018-11-09','Veterans Day','Residual'),
    ('2018-11-11','Veterans Day','Actual'),
    ('2018-11-12','Veterans Day','Observed'),
    ('2018-11-13','Veterans Day','Residual'),
    ('2018-11-16','Thanksgiving','Residual'),
    ('2018-11-19','Thanksgiving','Residual'),
    ('2018-11-20','Thanksgiving','Residual'),
    ('2018-11-21','Thanksgiving','Residual'),
    ('2018-11-22','Thanksgiving','Actual'),
    ('2018-11-23','Day After Thanksgiving','Actual'),
    ('2018-11-26','Day After Thanksgiving','Residual'),
    ('2018-12-14','Christmas Eve','Residual'),
    ('2018-12-17','Christmas Eve','Residual'),
    ('2018-12-18','Christmas Eve','Residual'),
    ('2018-12-19','Christmas Eve','Residual'),
    ('2018-12-20','Christmas Eve','Residual'),
    ('2018-12-21','Christmas Eve','Residual'),
    ('2018-12-24','Christmas Eve','Actual'),
    ('2018-12-25','Christmas','Actual'),
    ('2018-12-26','Christmas','Residual'),
    ('2018-12-27','Christmas','Residual'),
    ('2018-12-28','Christmas','Residual'),
    ('2018-12-31','New Years','Residual'),
    ('2019-01-01','New Years','Actual'),
    ('2019-01-02','New Years','Residual'),
    ('2019-01-18','Martin Luther King Jr. Day','Residual'),
    ('2019-01-21','Martin Luther King Jr. Day','Actual'),
    ('2019-01-22','Martin Luther King Jr. Day','Residual'),
    ('2019-02-15','Washington''s Birthday','Residual'),
    ('2019-02-18','Washington''s Birthday','Actual'),
    ('2019-02-19','Washington''s Birthday','Residual'),
    ('2019-03-29','Cesar Chavez Day','Residual'),
    ('2019-03-31','Cesar Chavez Day','Actual'),
    ('2019-04-01','Cesar Chavez Day','Observed'),
    ('2019-04-02','Cesar Chavez Day','Residual'),
    ('2019-04-18','Good Friday','Residual'),
    ('2019-04-19','Good Friday','Actual'),
    ('2019-04-22','Good Friday','Residual'),
    ('2019-05-24','Memorial Day','Residual'),
    ('2019-05-27','Memorial Day','Actual'),
    ('2019-05-28','Memorial Day','Residual'),
    ('2019-07-03','Independence Day','Residual'),
    ('2019-07-04','Independence Day','Actual'),
    ('2019-07-05','Independence Day','Residual'),
    ('2019-08-29','Labor Day','Residual'),
    ('2019-09-02','Labor Day','Actual'),
    ('2019-09-03','Labor Day','Residual'),
    ('2019-10-11','Columbus Day','Residual'),
    ('2019-10-14','Columbus Day','Actual'),
    ('2019-10-15','Columbus Day','Residual'),
    ('2019-11-08','Veterans Day','Residual'),
    ('2019-11-11','Veterans Day','Actual'),
    ('2019-11-12','Veterans Day','Residual'),
    ('2019-11-22','Thanksgiving','Residual'),
    ('2019-11-25','Thanksgiving','Residual'),
    ('2019-11-26','Thanksgiving','Residual'),
    ('2019-11-27','Thanksgiving','Residual'),
    ('2019-11-28','Thanksgiving','Actual'),
    ('2019-11-29','Day After Thanksgiving','Actual'),
    ('2019-12-02','Day After Thanksgiving','Residual'),
    ('2019-12-13','Christmas Eve','Residual'),
    ('2019-12-16','Christmas Eve','Residual'),
    ('2019-12-17','Christmas Eve','Residual'),
    ('2019-12-18','Christmas Eve','Residual'),
    ('2019-12-19','Christmas Eve','Residual'),
    ('2019-12-20','Christmas Eve','Residual'),
    ('2019-12-24','Christmas Eve','Actual'),
    ('2019-12-25','Christmas','Actual'),
    ('2019-12-26','Christmas','Residual'),
    ('2019-12-27','Christmas','Residual'),
    ('2019-12-30','New Years','Residual'),
    ('2019-12-31','New Years','Residual'),
    ('2020-01-01','New Years','Actual'),
    ('2020-01-02','New Years','Residual'),
    ('2020-01-17','Martin Luther King Jr. Day','Residual'),
    ('2020-01-20','Martin Luther King Jr. Day','Actual'),
    ('2020-01-21','Martin Luther King Jr. Day','Residual'),
    ('2020-02-14','Washington''s Birthday','Residual'),
    ('2020-02-17','Washington''s Birthday','Actual'),
    ('2020-02-18','Washington''s Birthday','Residual'),
    ('2020-03-30','Cesar Chavez Day','Residual'),
    ('2020-03-31','Cesar Chavez Day','Actual'),
    ('2020-04-01','Cesar Chavez Day','Residual'),
    ('2020-04-09','Good Friday','Residual'),
    ('2020-04-10','Good Friday','Actual'),
    ('2020-04-13','Good Friday','Residual'),
    ('2020-05-22','Memorial Day','Residual'),
    ('2020-05-25','Memorial Day','Actual'),
    ('2020-05-26','Memorial Day','Residual'),
    ('2020-07-02','Independence Day','Residual'),
    ('2020-07-03','Independence Day','Observed'),
    ('2020-07-04','Independence Day','Actual'),
    ('2020-07-06','Good Friday','Residual'),
    ('2020-09-04','Labor Day','Residual'),
    ('2020-09-07','Labor Day','Actual'),
    ('2020-09-08','Labor Day','Residual'),
    ('2020-10-09','Columbus Day','Residual'),
    ('2020-10-12','Columbus Day','Actual'),
    ('2020-10-13','Columbus Day','Residual'),
    ('2020-11-10','Veterans Day','Residual'),
    ('2020-11-11','Veterans Day','Actual'),
    ('2020-11-12','Veterans Day','Residual'),
    ('2020-11-20','Thanksgiving','Residual'),
    ('2020-11-23','Thanksgiving','Residual'),
    ('2020-11-24','Thanksgiving','Residual'),
    ('2020-11-25','Thanksgiving','Residual'),
    ('2020-11-26','Thanksgiving','Actual'),
    ('2020-11-27','Day After Thanksgiving','Actual'),
    ('2020-11-30','Day After Thanksgiving','Residual'),
    ('2020-12-18','Christmas Eve','Residual'),
    ('2020-12-21','Christmas Eve','Residual'),
    ('2020-12-22','Christmas Eve','Residual'),
    ('2020-12-23','Christmas Eve','Residual'),
    ('2020-12-24','Christmas Eve','Actual'),
    ('2020-12-25','Christmas','Actual'),
    ('2020-12-28','Christmas','Residual'),
    ('2020-12-29','Christmas','Residual')
GO


-- INRIX 15-minute time period cross-reference -------------------------------
CREATE TABLE [inrix].[time_min15_xref] (
	[min15] tinyint NOT NULL,
	[min15_period_start] time NOT NULL,
	[min15_period_end] time NOT NULL,
	[min30] tinyint NOT NULL,
	[min30_period_start] time NOT NULL,
	[min30_period_end] time NOT NULL,
	[abm_half_hour] tinyint NOT NULL,
	[abm_half_hour_period_start] time NOT NULL,
	[abm_half_hour_period_end] time NOT NULL,
	[min60] tinyint NOT NULL,
	[min60_period_start] time NOT NULL,
	[min60_period_end] time NOT NULL,
	[abm_5_tod] tinyint NOT NULL,
	[abm_5_tod_period_start] time NOT NULL,
	[abm_5_tod_period_end] time NOT NULL,
	[day] tinyint NOT NULL,
	[day_period_start] time NOT NULL,
	[day_period_end] time NOT NULL,
    INDEX [ccsi_inrix_time_min15_xref] CLUSTERED COLUMNSTORE,
    CONSTRAINT [ixuq_inrix_time_min15_xref] UNIQUE ([min15])
    )
INSERT INTO [inrix].[time_min15_xref] VALUES
    (1,'00:00:00.0000000','00:14:59.0000000',1,'00:00:00.0000000','00:29:59.0000000',40,'00:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','00:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (2,'00:15:00.0000000','00:29:59.0000000',1,'00:00:00.0000000','00:29:59.0000000',40,'00:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','00:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (3,'00:30:00.0000000','00:44:59.0000000',2,'00:30:00.0000000','00:59:59.0000000',40,'00:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','00:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (4,'00:45:00.0000000','00:59:59.0000000',2,'00:30:00.0000000','00:59:59.0000000',40,'00:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','00:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (5,'01:00:00.0000000','01:14:59.0000000',3,'01:00:00.0000000','01:29:59.0000000',40,'00:00:00.0000000','02:59:59.0000000',2,'01:00:00.0000000','01:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (6,'01:15:00.0000000','01:29:59.0000000',3,'01:00:00.0000000','01:29:59.0000000',40,'00:00:00.0000000','02:59:59.0000000',2,'01:00:00.0000000','01:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (7,'01:30:00.0000000','01:44:59.0000000',4,'01:30:00.0000000','01:59:59.0000000',40,'00:00:00.0000000','02:59:59.0000000',2,'01:00:00.0000000','01:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (8,'01:45:00.0000000','01:59:59.0000000',4,'01:30:00.0000000','01:59:59.0000000',40,'00:00:00.0000000','02:59:59.0000000',2,'01:00:00.0000000','01:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (9,'02:00:00.0000000','02:14:59.0000000',5,'02:00:00.0000000','02:29:59.0000000',40,'00:00:00.0000000','02:59:59.0000000',3,'02:00:00.0000000','02:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (10,'02:15:00.0000000','02:29:59.0000000',5,'02:00:00.0000000','02:29:59.0000000',40,'00:00:00.0000000','02:59:59.0000000',3,'02:00:00.0000000','02:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (11,'02:30:00.0000000','02:44:59.0000000',6,'02:30:00.0000000','02:59:59.0000000',40,'00:00:00.0000000','02:59:59.0000000',3,'02:00:00.0000000','02:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (12,'02:45:00.0000000','02:59:59.0000000',6,'02:30:00.0000000','02:59:59.0000000',40,'00:00:00.0000000','02:59:59.0000000',3,'02:00:00.0000000','02:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (13,'03:00:00.0000000','03:14:59.0000000',7,'03:00:00.0000000','03:29:59.0000000',1,'03:00:00.0000000','04:59:59.0000000',4,'03:00:00.0000000','03:59:59.0000000',1,'03:00:00.0000000','05:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (14,'03:15:00.0000000','03:29:59.0000000',7,'03:00:00.0000000','03:29:59.0000000',1,'03:00:00.0000000','04:59:59.0000000',4,'03:00:00.0000000','03:59:59.0000000',1,'03:00:00.0000000','05:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (15,'03:30:00.0000000','03:44:59.0000000',8,'03:30:00.0000000','03:59:59.0000000',1,'03:00:00.0000000','04:59:59.0000000',4,'03:00:00.0000000','03:59:59.0000000',1,'03:00:00.0000000','05:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (16,'03:45:00.0000000','03:59:59.0000000',8,'03:30:00.0000000','03:59:59.0000000',1,'03:00:00.0000000','04:59:59.0000000',4,'03:00:00.0000000','03:59:59.0000000',1,'03:00:00.0000000','05:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (17,'04:00:00.0000000','04:14:59.0000000',9,'04:00:00.0000000','04:29:59.0000000',1,'03:00:00.0000000','04:59:59.0000000',5,'04:00:00.0000000','04:59:59.0000000',1,'03:00:00.0000000','05:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (18,'04:15:00.0000000','04:29:59.0000000',9,'04:00:00.0000000','04:29:59.0000000',1,'03:00:00.0000000','04:59:59.0000000',5,'04:00:00.0000000','04:59:59.0000000',1,'03:00:00.0000000','05:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (19,'04:30:00.0000000','04:44:59.0000000',10,'04:30:00.0000000','04:59:59.0000000',1,'03:00:00.0000000','04:59:59.0000000',5,'04:00:00.0000000','04:59:59.0000000',1,'03:00:00.0000000','05:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (20,'04:45:00.0000000','04:59:59.0000000',10,'04:30:00.0000000','04:59:59.0000000',1,'03:00:00.0000000','04:59:59.0000000',5,'04:00:00.0000000','04:59:59.0000000',1,'03:00:00.0000000','05:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (21,'05:00:00.0000000','05:14:59.0000000',11,'05:00:00.0000000','05:29:59.0000000',2,'05:00:00.0000000','05:29:59.0000000',6,'05:00:00.0000000','05:59:59.0000000',1,'03:00:00.0000000','05:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (22,'05:15:00.0000000','05:29:59.0000000',11,'05:00:00.0000000','05:29:59.0000000',2,'05:00:00.0000000','05:29:59.0000000',6,'05:00:00.0000000','05:59:59.0000000',1,'03:00:00.0000000','05:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (23,'05:30:00.0000000','05:44:59.0000000',12,'05:30:00.0000000','05:59:59.0000000',3,'05:30:00.0000000','05:59:59.0000000',6,'05:00:00.0000000','05:59:59.0000000',1,'03:00:00.0000000','05:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (24,'05:45:00.0000000','05:59:59.0000000',12,'05:30:00.0000000','05:59:59.0000000',3,'05:30:00.0000000','05:59:59.0000000',6,'05:00:00.0000000','05:59:59.0000000',1,'03:00:00.0000000','05:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (25,'06:00:00.0000000','06:14:59.0000000',13,'06:00:00.0000000','06:29:59.0000000',4,'06:00:00.0000000','06:29:59.0000000',7,'06:00:00.0000000','06:59:59.0000000',2,'06:00:00.0000000','08:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (26,'06:15:00.0000000','06:29:59.0000000',13,'06:00:00.0000000','06:29:59.0000000',4,'06:00:00.0000000','06:29:59.0000000',7,'06:00:00.0000000','06:59:59.0000000',2,'06:00:00.0000000','08:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (27,'06:30:00.0000000','06:44:59.0000000',14,'06:30:00.0000000','06:59:59.0000000',5,'06:30:00.0000000','06:59:59.0000000',7,'06:00:00.0000000','06:59:59.0000000',2,'06:00:00.0000000','08:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (28,'06:45:00.0000000','06:59:59.0000000',14,'06:30:00.0000000','06:59:59.0000000',5,'06:30:00.0000000','06:59:59.0000000',7,'06:00:00.0000000','06:59:59.0000000',2,'06:00:00.0000000','08:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (29,'07:00:00.0000000','07:14:59.0000000',15,'07:00:00.0000000','07:29:59.0000000',6,'07:00:00.0000000','07:29:59.0000000',8,'07:00:00.0000000','07:59:59.0000000',2,'06:00:00.0000000','08:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (30,'07:15:00.0000000','07:29:59.0000000',15,'07:00:00.0000000','07:29:59.0000000',6,'07:00:00.0000000','07:29:59.0000000',8,'07:00:00.0000000','07:59:59.0000000',2,'06:00:00.0000000','08:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (31,'07:30:00.0000000','07:44:59.0000000',16,'07:30:00.0000000','07:59:59.0000000',7,'07:30:00.0000000','07:59:59.0000000',8,'07:00:00.0000000','07:59:59.0000000',2,'06:00:00.0000000','08:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (32,'07:45:00.0000000','07:59:59.0000000',16,'07:30:00.0000000','07:59:59.0000000',7,'07:30:00.0000000','07:59:59.0000000',8,'07:00:00.0000000','07:59:59.0000000',2,'06:00:00.0000000','08:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (33,'08:00:00.0000000','08:14:59.0000000',17,'08:00:00.0000000','08:29:59.0000000',8,'08:00:00.0000000','08:29:59.0000000',9,'08:00:00.0000000','08:59:59.0000000',2,'06:00:00.0000000','08:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (34,'08:15:00.0000000','08:29:59.0000000',17,'08:00:00.0000000','08:29:59.0000000',8,'08:00:00.0000000','08:29:59.0000000',9,'08:00:00.0000000','08:59:59.0000000',2,'06:00:00.0000000','08:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (35,'08:30:00.0000000','08:44:59.0000000',18,'08:30:00.0000000','08:59:59.0000000',9,'08:30:00.0000000','08:59:59.0000000',9,'08:00:00.0000000','08:59:59.0000000',2,'06:00:00.0000000','08:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (36,'08:45:00.0000000','08:59:59.0000000',18,'08:30:00.0000000','08:59:59.0000000',9,'08:30:00.0000000','08:59:59.0000000',9,'08:00:00.0000000','08:59:59.0000000',2,'06:00:00.0000000','08:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (37,'09:00:00.0000000','09:14:59.0000000',19,'09:00:00.0000000','09:29:59.0000000',10,'09:00:00.0000000','09:29:59.0000000',10,'09:00:00.0000000','09:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (38,'09:15:00.0000000','09:29:59.0000000',19,'09:00:00.0000000','09:29:59.0000000',10,'09:00:00.0000000','09:29:59.0000000',10,'09:00:00.0000000','09:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (39,'09:30:00.0000000','09:44:59.0000000',20,'09:30:00.0000000','09:59:59.0000000',11,'09:30:00.0000000','09:59:59.0000000',10,'09:00:00.0000000','09:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (40,'09:45:00.0000000','09:59:59.0000000',20,'09:30:00.0000000','09:59:59.0000000',11,'09:30:00.0000000','09:59:59.0000000',10,'09:00:00.0000000','09:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (41,'10:00:00.0000000','10:14:59.0000000',21,'10:00:00.0000000','10:29:59.0000000',12,'10:00:00.0000000','10:29:59.0000000',11,'10:00:00.0000000','10:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (42,'10:15:00.0000000','10:29:59.0000000',21,'10:00:00.0000000','10:29:59.0000000',12,'10:00:00.0000000','10:29:59.0000000',11,'10:00:00.0000000','10:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (43,'10:30:00.0000000','10:44:59.0000000',22,'10:30:00.0000000','10:59:59.0000000',13,'10:30:00.0000000','10:59:59.0000000',11,'10:00:00.0000000','10:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (44,'10:45:00.0000000','10:59:59.0000000',22,'10:30:00.0000000','10:59:59.0000000',13,'10:30:00.0000000','10:59:59.0000000',11,'10:00:00.0000000','10:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (45,'11:00:00.0000000','11:14:59.0000000',23,'11:00:00.0000000','11:29:59.0000000',14,'11:00:00.0000000','11:29:59.0000000',12,'11:00:00.0000000','11:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (46,'11:15:00.0000000','11:29:59.0000000',23,'11:00:00.0000000','11:29:59.0000000',14,'11:00:00.0000000','11:29:59.0000000',12,'11:00:00.0000000','11:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (47,'11:30:00.0000000','11:44:59.0000000',24,'11:30:00.0000000','11:59:59.0000000',15,'11:30:00.0000000','11:59:59.0000000',12,'11:00:00.0000000','11:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (48,'11:45:00.0000000','11:59:59.0000000',24,'11:30:00.0000000','11:59:59.0000000',15,'11:30:00.0000000','11:59:59.0000000',12,'11:00:00.0000000','11:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (49,'12:00:00.0000000','12:14:59.0000000',25,'12:00:00.0000000','12:29:59.0000000',16,'12:00:00.0000000','12:29:59.0000000',13,'12:00:00.0000000','12:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (50,'12:15:00.0000000','12:29:59.0000000',25,'12:00:00.0000000','12:29:59.0000000',16,'12:00:00.0000000','12:29:59.0000000',13,'12:00:00.0000000','12:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (51,'12:30:00.0000000','12:44:59.0000000',26,'12:30:00.0000000','12:59:59.0000000',17,'12:30:00.0000000','12:59:59.0000000',13,'12:00:00.0000000','12:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (52,'12:45:00.0000000','12:59:59.0000000',26,'12:30:00.0000000','12:59:59.0000000',17,'12:30:00.0000000','12:59:59.0000000',13,'12:00:00.0000000','12:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (53,'13:00:00.0000000','13:14:59.0000000',27,'13:00:00.0000000','13:29:59.0000000',18,'13:00:00.0000000','13:29:59.0000000',14,'13:00:00.0000000','13:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (54,'13:15:00.0000000','13:29:59.0000000',27,'13:00:00.0000000','13:29:59.0000000',18,'13:00:00.0000000','13:29:59.0000000',14,'13:00:00.0000000','13:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (55,'13:30:00.0000000','13:44:59.0000000',28,'13:30:00.0000000','13:59:59.0000000',19,'13:30:00.0000000','13:59:59.0000000',14,'13:00:00.0000000','13:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (56,'13:45:00.0000000','13:59:59.0000000',28,'13:30:00.0000000','13:59:59.0000000',19,'13:30:00.0000000','13:59:59.0000000',14,'13:00:00.0000000','13:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (57,'14:00:00.0000000','14:14:59.0000000',29,'14:00:00.0000000','14:29:59.0000000',20,'14:00:00.0000000','14:29:59.0000000',15,'14:00:00.0000000','14:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (58,'14:15:00.0000000','14:29:59.0000000',29,'14:00:00.0000000','14:29:59.0000000',20,'14:00:00.0000000','14:29:59.0000000',15,'14:00:00.0000000','14:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (59,'14:30:00.0000000','14:44:59.0000000',30,'14:30:00.0000000','14:59:59.0000000',21,'14:30:00.0000000','14:59:59.0000000',15,'14:00:00.0000000','14:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (60,'14:45:00.0000000','14:59:59.0000000',30,'14:30:00.0000000','14:59:59.0000000',21,'14:30:00.0000000','14:59:59.0000000',15,'14:00:00.0000000','14:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (61,'15:00:00.0000000','15:14:59.0000000',31,'15:00:00.0000000','15:29:59.0000000',22,'15:00:00.0000000','15:29:59.0000000',16,'15:00:00.0000000','15:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (62,'15:15:00.0000000','15:29:59.0000000',31,'15:00:00.0000000','15:29:59.0000000',22,'15:00:00.0000000','15:29:59.0000000',16,'15:00:00.0000000','15:59:59.0000000',3,'09:00:00.0000000','15:29:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (63,'15:30:00.0000000','15:44:59.0000000',32,'15:30:00.0000000','15:59:59.0000000',23,'15:30:00.0000000','15:59:59.0000000',16,'15:00:00.0000000','15:59:59.0000000',4,'15:30:00.0000000','18:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (64,'15:45:00.0000000','15:59:59.0000000',32,'15:30:00.0000000','15:59:59.0000000',23,'15:30:00.0000000','15:59:59.0000000',16,'15:00:00.0000000','15:59:59.0000000',4,'15:30:00.0000000','18:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (65,'16:00:00.0000000','16:14:59.0000000',33,'16:00:00.0000000','16:29:59.0000000',24,'16:00:00.0000000','16:29:59.0000000',17,'16:00:00.0000000','16:59:59.0000000',4,'15:30:00.0000000','18:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (66,'16:15:00.0000000','16:29:59.0000000',33,'16:00:00.0000000','16:29:59.0000000',24,'16:00:00.0000000','16:29:59.0000000',17,'16:00:00.0000000','16:59:59.0000000',4,'15:30:00.0000000','18:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (67,'16:30:00.0000000','16:44:59.0000000',34,'16:30:00.0000000','16:59:59.0000000',25,'16:30:00.0000000','16:59:59.0000000',17,'16:00:00.0000000','16:59:59.0000000',4,'15:30:00.0000000','18:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (68,'16:45:00.0000000','16:59:59.0000000',34,'16:30:00.0000000','16:59:59.0000000',25,'16:30:00.0000000','16:59:59.0000000',17,'16:00:00.0000000','16:59:59.0000000',4,'15:30:00.0000000','18:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (69,'17:00:00.0000000','17:14:59.0000000',35,'17:00:00.0000000','17:29:59.0000000',26,'17:00:00.0000000','17:29:59.0000000',18,'17:00:00.0000000','17:59:59.0000000',4,'15:30:00.0000000','18:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (70,'17:15:00.0000000','17:29:59.0000000',35,'17:00:00.0000000','17:29:59.0000000',26,'17:00:00.0000000','17:29:59.0000000',18,'17:00:00.0000000','17:59:59.0000000',4,'15:30:00.0000000','18:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (71,'17:30:00.0000000','17:44:59.0000000',36,'17:30:00.0000000','17:59:59.0000000',27,'17:30:00.0000000','17:59:59.0000000',18,'17:00:00.0000000','17:59:59.0000000',4,'15:30:00.0000000','18:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (72,'17:45:00.0000000','17:59:59.0000000',36,'17:30:00.0000000','17:59:59.0000000',27,'17:30:00.0000000','17:59:59.0000000',18,'17:00:00.0000000','17:59:59.0000000',4,'15:30:00.0000000','18:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (73,'18:00:00.0000000','18:14:59.0000000',37,'18:00:00.0000000','18:29:59.0000000',28,'18:00:00.0000000','18:29:59.0000000',19,'18:00:00.0000000','18:59:59.0000000',4,'15:30:00.0000000','18:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (74,'18:15:00.0000000','18:29:59.0000000',37,'18:00:00.0000000','18:29:59.0000000',28,'18:00:00.0000000','18:29:59.0000000',19,'18:00:00.0000000','18:59:59.0000000',4,'15:30:00.0000000','18:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (75,'18:30:00.0000000','18:44:59.0000000',38,'18:30:00.0000000','18:59:59.0000000',29,'18:30:00.0000000','18:59:59.0000000',19,'18:00:00.0000000','18:59:59.0000000',4,'15:30:00.0000000','18:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (76,'18:45:00.0000000','18:59:59.0000000',38,'18:30:00.0000000','18:59:59.0000000',29,'18:30:00.0000000','18:59:59.0000000',19,'18:00:00.0000000','18:59:59.0000000',4,'15:30:00.0000000','18:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (77,'19:00:00.0000000','19:14:59.0000000',39,'19:00:00.0000000','19:29:59.0000000',30,'19:00:00.0000000','19:29:59.0000000',20,'19:00:00.0000000','19:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (78,'19:15:00.0000000','19:29:59.0000000',39,'19:00:00.0000000','19:29:59.0000000',30,'19:00:00.0000000','19:29:59.0000000',20,'19:00:00.0000000','19:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (79,'19:30:00.0000000','19:44:59.0000000',40,'19:30:00.0000000','19:59:59.0000000',31,'19:30:00.0000000','19:59:59.0000000',20,'19:00:00.0000000','19:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (80,'19:45:00.0000000','19:59:59.0000000',40,'19:30:00.0000000','19:59:59.0000000',31,'19:30:00.0000000','19:59:59.0000000',20,'19:00:00.0000000','19:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (81,'20:00:00.0000000','20:14:59.0000000',41,'20:00:00.0000000','20:29:59.0000000',32,'20:00:00.0000000','20:29:59.0000000',21,'20:00:00.0000000','20:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (82,'20:15:00.0000000','20:29:59.0000000',41,'20:00:00.0000000','20:29:59.0000000',32,'20:00:00.0000000','20:29:59.0000000',21,'20:00:00.0000000','20:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (83,'20:30:00.0000000','20:44:59.0000000',42,'20:30:00.0000000','20:59:59.0000000',33,'20:30:00.0000000','20:59:59.0000000',21,'20:00:00.0000000','20:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (84,'20:45:00.0000000','20:59:59.0000000',42,'20:30:00.0000000','20:59:59.0000000',33,'20:30:00.0000000','20:59:59.0000000',21,'20:00:00.0000000','20:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (85,'21:00:00.0000000','21:14:59.0000000',43,'21:00:00.0000000','21:29:59.0000000',34,'21:00:00.0000000','21:29:59.0000000',22,'21:00:00.0000000','21:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (86,'21:15:00.0000000','21:29:59.0000000',43,'21:00:00.0000000','21:29:59.0000000',34,'21:00:00.0000000','21:29:59.0000000',22,'21:00:00.0000000','21:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (87,'21:30:00.0000000','21:44:59.0000000',44,'21:30:00.0000000','21:59:59.0000000',35,'21:30:00.0000000','21:59:59.0000000',22,'21:00:00.0000000','21:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (88,'21:45:00.0000000','21:59:59.0000000',44,'21:30:00.0000000','21:59:59.0000000',35,'21:30:00.0000000','21:59:59.0000000',22,'21:00:00.0000000','21:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (89,'22:00:00.0000000','22:14:59.0000000',45,'22:00:00.0000000','22:29:59.0000000',36,'22:00:00.0000000','22:29:59.0000000',23,'22:00:00.0000000','22:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (90,'22:15:00.0000000','22:29:59.0000000',45,'22:00:00.0000000','22:29:59.0000000',36,'22:00:00.0000000','22:29:59.0000000',23,'22:00:00.0000000','22:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (91,'22:30:00.0000000','22:44:59.0000000',46,'22:30:00.0000000','22:59:59.0000000',37,'22:30:00.0000000','22:59:59.0000000',23,'22:00:00.0000000','22:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (92,'22:45:00.0000000','22:59:59.0000000',46,'22:30:00.0000000','22:59:59.0000000',37,'22:30:00.0000000','22:59:59.0000000',23,'22:00:00.0000000','22:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (93,'23:00:00.0000000','23:14:59.0000000',47,'23:00:00.0000000','23:29:59.0000000',38,'23:00:00.0000000','23:29:59.0000000',24,'23:00:00.0000000','23:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (94,'23:15:00.0000000','23:29:59.0000000',47,'23:00:00.0000000','23:29:59.0000000',38,'23:00:00.0000000','23:29:59.0000000',24,'23:00:00.0000000','23:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (95,'23:30:00.0000000','23:44:59.0000000',48,'23:30:00.0000000','23:59:59.0000000',39,'23:30:00.0000000','23:59:59.0000000',24,'23:00:00.0000000','23:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000'),
    (96,'23:45:00.0000000','23:59:59.0000000',48,'23:30:00.0000000','23:59:59.0000000',39,'23:30:00.0000000','23:59:59.0000000',24,'23:00:00.0000000','23:59:59.0000000',5,'19:00:00.0000000','02:59:59.0000000',1,'00:00:00.0000000','23:59:59.0000000')
GO


-- create xd segment metadata table ------------------------------------------
CREATE TABLE [inrix].[xdseg_metadata] (
	[segment_id] [bigint] IDENTITY(1, 1) NOT NULL,
	[vintage] [nvarchar](20) NOT NULL,
	[xdsegid] [bigint] NOT NULL,
	[frc] [smallint] NOT NULL,
	[road_number] [smallint] NULL,
	[road_name] [nvarchar](150) NULL,
	[county] [nvarchar](10) NOT NULL,
	[district] [nvarchar](25) NULL,
	[miles] [float] NOT NULL,
	[lanes] [float] NOT NULL,
	[slip_road] [bit] NOT NULL,
	[special_road] [nvarchar](5) NULL,
	[road_list] [nvarchar](100) NULL,
	[bearing] [nvarchar](5) NOT NULL,
	[xdgroup] [int] NOT NULL,
	[shape] [geometry] NOT NULL,
    CONSTRAINT [pk_inrix_xdseg_metadata] PRIMARY KEY ([segment_id]),
    CONSTRAINT [ixuq_inrix_xdseg_metadata] UNIQUE ([vintage], [xdsegid])
    )
WITH (DATA_COMPRESSION = PAGE)
GO


-- create INRIX speed dataset 15 min data ------------------------------------
CREATE TABLE [inrix].[speed_15min](
    [speed_15min_id] [bigint] IDENTITY(1, 1) NOT NULL,
    [segment_id] [bigint] NOT NULL,
	[date_time] [datetimeoffset](0) NOT NULL,
	[speed] [float] NULL,
	[hist_av_speed] [float] NULL,
	[ref_speed] [float] NOT NULL,
	[travel_time] [float] NULL,
	[c_value] [float] NULL,
	[pct_score30] [float] NULL,
	[pct_score20] [float] NULL,
	[pct_score10] [float] NULL,
	[road_closure] [nvarchar](5) NULL,
	INDEX [ccsi_inrixspeed_15min] CLUSTERED COLUMNSTORE
)
GO


-- create INRIX 15-minute speed aggregator ------------------------------------
CREATE PROCEDURE [inrix].[sp_agg_speed_15min]
    @time_column nvarchar(max),  -- column in [inrix].[time_min15_xref]
    -- table used to aggregate XD link speed data to user-specified
    -- temporal resolution
    @year_filter integer -- year of data to calculate metric for
AS
/**
summary:   >
    Aggregates the post-2017 INRIX fifteen minute speed dataset within each
	month of available data for a user-specified year at a user-specified time
    resolution. Note the data operates at the fifteen minute resolution so
    aggregation can only be done at the fifteen minute level or above.

    Provides the average speed weighted by the number of observations
    in the raw dataset used to calculate the metric for each user-specified
	time resolution period.

    Also provided are the total number of records in the raw dataset used to
	calculate the metric within the given year, month, station, and
	user-specified time resolution period.

    Weekends, holidays, records where [speed] <= 5, and records where
	[c_value] = 0  are removed from the aggregation.
    The result set can be further filtered or aggregated across month
    and user-specified time resolution periods making sure to weight by the
    number of observations [n] using the formulas:
        [metric] = SUM([metric] * [n]) / SUM([n])
**/
BEGIN
    IF NOT EXISTS(SELECT [COLUMN_NAME] FROM INFORMATION_SCHEMA.COLUMNS WHERE [TABLE_SCHEMA] = 'inrix' AND [TABLE_NAME] = 'time_min15_xref' AND [COLUMN_NAME] = @time_column)
    BEGIN
        RAISERROR ('The column %s does not exist in the [inrix].[time_min15_xref] table.', 16, 1, @time_column)
    END
    ELSE
    BEGIN
		-- build dynamic SQL string
		DECLARE @sql nvarchar(max) = '
		with [tbl_day] AS (
			SELECT
				CONVERT(DATE, [date_time]) AS [date]
				,DATEPART(MONTH, [date_time]) AS [month_number]
				,DATENAME(MONTH, [date_time]) AS [month]
				,[segment_id]
				,[time_min15_xref].' + @time_column + '
				,AVG([speed]) AS [speed]  -- speed aggregated to time periods of interest within the day
				,COUNT([speed]) AS [n]  -- total number of valid records across all records aggregated to time periods of interest within the day
			FROM
				[inrix].[speed_15min]
			INNER JOIN
				[inrix].[time_min15_xref]
			ON
				-- the CAST, DATEADD, and DATEDIFF acts as a floor function
				-- removing seconds and milliseconds from the INRIX timestamp
				CAST(DATEADD(minute, DATEDIFF(minute, 0, [date_time]), 0) AS TIME) = [time_min15_xref].[min15_period_start]
			WHERE
				DATENAME(WEEKDAY, [date_time]) NOT IN (''Saturday'', ''Sunday'')  -- remove weekends from the aggregation
				AND CONVERT(DATE, [date_time]) NOT IN (SELECT [date] FROM [inrix].[holiday])  -- remove holidays from the aggregation
				AND [speed] > 5  -- exclude suspicious speed which is likely under construction at the time
				AND [c_value] > 0  -- filter the speed dataset for real-time speed only
				AND DATENAME(YEAR, [date_time]) = ' + CONVERT(nvarchar, @year_filter) + '
			GROUP BY
				CONVERT(DATE, [date_time])
				,DATEPART(MONTH, [date_time])
				,DATENAME(MONTH, [date_time])
				,[segment_id]
				,[time_min15_xref].' + @time_column + '),
		[records_check] AS (
			SELECT
				' + @time_column + '
				,COUNT([min15]) AS [n]
			FROM
				[inrix].[time_min15_xref]
			GROUP BY
				' + @time_column + ')
		SELECT
			' + CONVERT(nvarchar, @year_filter) + ' AS [year]
			,[month]
			,[segment_id]
			,[tbl_day].' + @time_column + '
			,SUM(1.0 * [speed] * [tbl_day].[n]) / SUM([tbl_day].[n]) AS [speed]  -- speed weighted by number of samples used in computing each record
			,SUM([tbl_day].[n]) AS [n]  -- total number of valid records used in computing metric values that make up the average metric
		FROM
			[tbl_day]
		GROUP BY
			[month_number]
			,[month]
			,[segment_id]
			,[tbl_day].' + @time_column

        -- execute dynamic SQL string
	    EXECUTE (@sql)
    END
END
GO
